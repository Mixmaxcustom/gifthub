#!/usr/bin/env node
const { exec}   = require('child_process');
const fs        = require('fs');
const path      = require('path');


let pargs = process.argv.slice(2);

if (pargs.length > 0) {

    // sql file to run
    var sqlfn = pargs[0];

    // read the mysql config  
    fs.readFile(path.join(__dirname, "./mysql-config.json"), 'utf-8', (err, data) => {
        if (err) { return console.log(err)};
        var dbuser = JSON.parse(data);

        let sqlfile = path.join(__dirname, `../db/${sqlfn}`)

        exec(`mysql -u ${dbuser.user} -p${dbuser.password} < ${sqlfile}`, (err, stdout, stderr) => {
            if (err) {
                // console.log(err);
                // node couldn't execute the command
                return;
            }
            console.log(`-> executing: '${sqlfile}'`);

            // the *entire* stdout and stderr (buffered)
            console.log(`${stdout}`);
            console.log(`${stderr}`);
        });
    });
}